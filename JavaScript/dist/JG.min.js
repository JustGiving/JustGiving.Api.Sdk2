/*! JG 2015-04-01 */
!function(a,b){"use strict";var c=function(a){if("object"!=typeof a.document)throw new Error("Cookies.js requires a `window` with a `document` object");var c=function(a,b,d){return 1===arguments.length?c.get(a):c.set(a,b,d)};return c._document=a.document,c._cacheKeyPrefix="cookey.",c._maxExpireDate=new Date("Fri, 31 Dec 9999 23:59:59 UTC"),c.defaults={path:"/",secure:!1},c.get=function(a){return c._cachedDocumentCookie!==c._document.cookie&&c._renewCache(),c._cache[c._cacheKeyPrefix+a]},c.set=function(a,d,e){return e=c._getExtendedOptions(e),e.expires=c._getExpiresDate(d===b?-1:e.expires),c._document.cookie=c._generateCookieString(a,d,e),c},c.expire=function(a,d){return c.set(a,b,d)},c._getExtendedOptions=function(a){return{path:a&&a.path||c.defaults.path,domain:a&&a.domain||c.defaults.domain,expires:a&&a.expires||c.defaults.expires,secure:a&&a.secure!==b?a.secure:c.defaults.secure}},c._isValidDate=function(a){return"[object Date]"===Object.prototype.toString.call(a)&&!isNaN(a.getTime())},c._getExpiresDate=function(a,b){if(b=b||new Date,"number"==typeof a?a=a===1/0?c._maxExpireDate:new Date(b.getTime()+1e3*a):"string"==typeof a&&(a=new Date(a)),a&&!c._isValidDate(a))throw new Error("`expires` parameter cannot be converted to a valid Date instance");return a},c._generateCookieString=function(a,b,c){a=a.replace(/[^#$&+\^`|]/g,encodeURIComponent),a=a.replace(/\(/g,"%28").replace(/\)/g,"%29"),b=(b+"").replace(/[^!#$&-+\--:<-\[\]-~]/g,encodeURIComponent),c=c||{};var d=a+"="+b;return d+=c.path?";path="+c.path:"",d+=c.domain?";domain="+c.domain:"",d+=c.expires?";expires="+c.expires.toUTCString():"",d+=c.secure?";secure":""},c._getCacheFromString=function(a){for(var d={},e=a?a.split("; "):[],f=0;f<e.length;f++){var g=c._getKeyValuePairFromCookieString(e[f]);d[c._cacheKeyPrefix+g.key]===b&&(d[c._cacheKeyPrefix+g.key]=g.value)}return d},c._getKeyValuePairFromCookieString=function(a){var b=a.indexOf("=");return b=0>b?a.length:b,{key:decodeURIComponent(a.substr(0,b)),value:decodeURIComponent(a.substr(b+1))}},c._renewCache=function(){c._cache=c._getCacheFromString(c._document.cookie),c._cachedDocumentCookie=c._document.cookie},c._areEnabled=function(){var a="cookies.js",b="1"===c.set(a,1).get(a);return c.expire(a),b},c.enabled=c._areEnabled(),c},d="object"==typeof a.document?c(a):c;"function"==typeof define&&define.amd?define(function(){return d}):"object"==typeof exports?("object"==typeof module&&"object"==typeof module.exports&&(exports=module.exports=d),exports.Cookies=d):a.Cookies=d}("undefined"==typeof window?this:window),function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){var c=a("Base64");b.exports=function(a){var b=a.replace("-","+").replace("_","/");switch(b.length%4){case 0:break;case 2:b+="==";break;case 3:b+="=";break;default:throw"Illegal base64url string!"}var d=c.atob(b);try{return decodeURIComponent(escape(d))}catch(e){return d}}},{Base64:4}],2:[function(a,b){var c=a("./base64_url_decode"),d=a("./json_parse");b.exports=function(a){return d(c(a.split(".")[1]))}},{"./base64_url_decode":1,"./json_parse":3}],3:[function(require,module,exports){module.exports=function(str){return window.JSON?window.JSON.parse(str):eval("("+str+")")}},{}],4:[function(a,b,c){!function(){var a="undefined"!=typeof c?c:this,b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",d=function(){try{document.createElement("$")}catch(a){return a}}();a.btoa||(a.btoa=function(a){for(var c,e,f=0,g=b,h="";a.charAt(0|f)||(g="=",f%1);h+=g.charAt(63&c>>8-f%1*8)){if(e=a.charCodeAt(f+=.75),e>255)throw d;c=c<<8|e}return h}),a.atob||(a.atob=function(a){if(a=a.replace(/=+$/,""),a.length%4==1)throw d;for(var c,e,f=0,g=0,h="";e=a.charAt(g++);~e&&(c=f%4?64*c+e:e,f++%4)?h+=String.fromCharCode(255&c>>(-2*f&6)):0)e=b.indexOf(e);return h})}()},{}],5:[function(a){var b="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},c=a("./lib/index");"function"==typeof b.window.define&&b.window.define.amd?b.window.define("jwt_decode",function(){return c}):b.window&&(b.window.jwt_decode=c)},{"./lib/index":2}]},{},[5]);var JG=function(){var a,b,c,d,e,f,g=function(f){if(JG.CustomElements.register(),a=f.appId,b=f.scope?p.defaultScopes+" "+f.scope:p.defaultScopes,c=f.environment||"production",d=p.environments[c],e=p.identityServers[c]+p.authorizeResource,window.location.hash)var g=n();g||o()},h=function(a){var b,c=Cookies.get("JGOAUTH");if(c)try{b=JSON.parse(c)}catch(d){b={connected:!1}}else b={connected:!1};a(b)},i=function(){Cookies.expire("JGOAUTH")},j=function(a,b){var c=l("GET","/v1/fundraising/pages");c.onload=function(){if(c.status>=200&&c.status<400){var b=JSON.parse(c.responseText);a(b)}},c.onerror=function(){b&&b()},c.send()},k=function(a,b){var c=l("GET","/v1/account/feed");c.onload=function(){if(c.status>=200&&c.status<400){var b=JSON.parse(c.responseText);a(b)}},c.onerror=function(){b&&b()},c.send()},l=function(b,c){var e=new XMLHttpRequest;return e.open(b,d+c,!0),f&&e.setRequestHeader("Authorization","Bearer "+f),e.setRequestHeader("x-app-id",a),e.setRequestHeader("Accept","application/json"),e},m=function(){var c=document.location.href.match(/(^[^#]*)/)[0],d="id_token token",f=Date.now()+""+Math.random(),g=Math.random();localStorage.state=f;var h=e+"?client_id="+encodeURI(a)+"&redirect_uri="+encodeURI(c)+"&response_type="+encodeURI(d)+"&scope="+encodeURI(b)+"&state="+encodeURI(f)+"&nonce="+encodeURI(g);window.location=h},n=function(){var a=window.location.hash.substr(1),b=a.split("&").reduce(function(a,b){var c=b.split("=");return a[c[0]]=c[1],a},{}),c=!b.error,d={};if(c&&(b.state!==localStorage.state?c=!1:(localStorage.removeItem("state"),f=b.access_token,d=jwt_decode(b.id_token))),c){var e={connected:!0,accessToken:b.access_token,displayName:d.name,userId:d.sub,email:d.email};Cookies.set("JGOAUTH",JSON.stringify(e),{expires:b.expires})}else Cookies.expire("JGOAUTH");var g=document.querySelectorAll("jg-login");return[].forEach.call(g,function(a){if(a.getAttribute("onlogin")){var b=a.getAttribute("onlogin"),c=window[b];c()}}),c},o=function(){var a=document.querySelectorAll("jg-login");[].forEach.call(a,function(a){a.innerHTML="Connect with JustGiving",a.style.fontWeight=400,a.style.fontFamily="roboto, arial",a.style.textDecoration="none",a.style.display="inline",a.style.width="auto",a.style.whiteSpace="normal",a.style.verticalAlign="top",a.style.padding="0.5em",a.style.cursor="pointer",a.style.color="#ffffff",a.style.background="#882c84",a.style.fontSize="100%",a.style.borderRadius="2px",a.style.fontSmoothingEnabled=!0,a.style.textAlign="center",a.style.marginTop="64px",a.addEventListener("click",function(){m()})})},p=function(){var a="openid profile email fundraise account",b="/connect/authorize",c=new Array;c.local="http://api.local.justgiving.com",c.dev="https://api-integration.staging.justgiving.com",c.staging="https://api-integration.staging.justgiving.com",c.sandbox="https://api-sandbox.justgiving.com",c.production="https://api.justgiving.com";var d=new Array;return d.local="https://identity.local.justgiving.com",d.dev="https://identity.dev.justgiving.com",d.staging="https://identity.staging.justgiving.com",d.sandbox="https://identity.sandbox.justgiving.com",d.production="https://identity.justgiving.com",{defaultScopes:a,authorizeResource:b,environments:c,identityServers:d}}(),q=function(){var a=function(){b()},b=function(){document.registerElement("jg-login",{prototype:Object.create(HTMLSpanElement.prototype),"extends":"span"})};return{register:a}}();return{init:g,checkConnected:h,signOut:i,getFundraisingPages:j,getFeed:k,CustomElements:q}}();window.onload=function(){},function(a,b){"use strict";var c=function(a){if("object"!=typeof a.document)throw new Error("Cookies.js requires a `window` with a `document` object");var c=function(a,b,d){return 1===arguments.length?c.get(a):c.set(a,b,d)};return c._document=a.document,c._cacheKeyPrefix="cookey.",c._maxExpireDate=new Date("Fri, 31 Dec 9999 23:59:59 UTC"),c.defaults={path:"/",secure:!1},c.get=function(a){return c._cachedDocumentCookie!==c._document.cookie&&c._renewCache(),c._cache[c._cacheKeyPrefix+a]},c.set=function(a,d,e){return e=c._getExtendedOptions(e),e.expires=c._getExpiresDate(d===b?-1:e.expires),c._document.cookie=c._generateCookieString(a,d,e),c},c.expire=function(a,d){return c.set(a,b,d)},c._getExtendedOptions=function(a){return{path:a&&a.path||c.defaults.path,domain:a&&a.domain||c.defaults.domain,expires:a&&a.expires||c.defaults.expires,secure:a&&a.secure!==b?a.secure:c.defaults.secure}},c._isValidDate=function(a){return"[object Date]"===Object.prototype.toString.call(a)&&!isNaN(a.getTime())},c._getExpiresDate=function(a,b){if(b=b||new Date,"number"==typeof a?a=a===1/0?c._maxExpireDate:new Date(b.getTime()+1e3*a):"string"==typeof a&&(a=new Date(a)),a&&!c._isValidDate(a))throw new Error("`expires` parameter cannot be converted to a valid Date instance");return a},c._generateCookieString=function(a,b,c){a=a.replace(/[^#$&+\^`|]/g,encodeURIComponent),a=a.replace(/\(/g,"%28").replace(/\)/g,"%29"),b=(b+"").replace(/[^!#$&-+\--:<-\[\]-~]/g,encodeURIComponent),c=c||{};var d=a+"="+b;return d+=c.path?";path="+c.path:"",d+=c.domain?";domain="+c.domain:"",d+=c.expires?";expires="+c.expires.toUTCString():"",d+=c.secure?";secure":""},c._getCacheFromString=function(a){for(var d={},e=a?a.split("; "):[],f=0;f<e.length;f++){var g=c._getKeyValuePairFromCookieString(e[f]);d[c._cacheKeyPrefix+g.key]===b&&(d[c._cacheKeyPrefix+g.key]=g.value)}return d},c._getKeyValuePairFromCookieString=function(a){var b=a.indexOf("=");return b=0>b?a.length:b,{key:decodeURIComponent(a.substr(0,b)),value:decodeURIComponent(a.substr(b+1))}},c._renewCache=function(){c._cache=c._getCacheFromString(c._document.cookie),c._cachedDocumentCookie=c._document.cookie},c._areEnabled=function(){var a="cookies.js",b="1"===c.set(a,1).get(a);return c.expire(a),b},c.enabled=c._areEnabled(),c},d="object"==typeof a.document?c(a):c;"function"==typeof define&&define.amd?define(function(){return d}):"object"==typeof exports?("object"==typeof module&&"object"==typeof module.exports&&(exports=module.exports=d),exports.Cookies=d):a.Cookies=d}("undefined"==typeof window?this:window),function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};a[g][0].call(j.exports,function(b){var c=a[g][1][b];return e(c?c:b)},j,j.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){var c=a("Base64");b.exports=function(a){var b=a.replace("-","+").replace("_","/");switch(b.length%4){case 0:break;case 2:b+="==";break;case 3:b+="=";break;default:throw"Illegal base64url string!"}var d=c.atob(b);try{return decodeURIComponent(escape(d))}catch(e){return d}}},{Base64:4}],2:[function(a,b){var c=a("./base64_url_decode"),d=a("./json_parse");b.exports=function(a){return d(c(a.split(".")[1]))}},{"./base64_url_decode":1,"./json_parse":3}],3:[function(require,module,exports){module.exports=function(str){return window.JSON?window.JSON.parse(str):eval("("+str+")")}},{}],4:[function(a,b,c){!function(){var a="undefined"!=typeof c?c:this,b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",d=function(){try{document.createElement("$")}catch(a){return a}}();a.btoa||(a.btoa=function(a){for(var c,e,f=0,g=b,h="";a.charAt(0|f)||(g="=",f%1);h+=g.charAt(63&c>>8-f%1*8)){if(e=a.charCodeAt(f+=.75),e>255)throw d;c=c<<8|e}return h}),a.atob||(a.atob=function(a){if(a=a.replace(/=+$/,""),a.length%4==1)throw d;for(var c,e,f=0,g=0,h="";e=a.charAt(g++);~e&&(c=f%4?64*c+e:e,f++%4)?h+=String.fromCharCode(255&c>>(-2*f&6)):0)e=b.indexOf(e);return h})}()},{}],5:[function(a){var b="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},c=a("./lib/index");"function"==typeof b.window.define&&b.window.define.amd?b.window.define("jwt_decode",function(){return c}):b.window&&(b.window.jwt_decode=c)},{"./lib/index":2}]},{},[5]);var JG=function(){var a,b,c,d,e,f,g=function(f){JG.CustomElements.register(),a=f.appId,b=f.scope?p.defaultScopes+" "+f.scope:p.defaultScopes,c=f.environment||"production",d=p.environments[c],e=p.identityServers[c]+p.authorizeResource;var g=!1;g=window.location.hash?n():h(),g||o()},h=function(a){var b,c=Cookies.get("JGOAUTH");if(c)try{b=JSON.parse(c)}catch(d){b={connected:!1}}else b={connected:!1};return a(b),b.connected},i=function(){Cookies.expire("JGOAUTH")},j=function(a,b){var c=l("GET","/v1/fundraising/pages");c.onload=function(){if(c.status>=200&&c.status<400){var b=JSON.parse(c.responseText);a(b)}},c.onerror=function(){b&&b()},c.send()},k=function(a,b){var c=l("GET","/v1/account/feed");c.onload=function(){if(c.status>=200&&c.status<400){var b=JSON.parse(c.responseText);a(b)}},c.onerror=function(){b&&b()},c.send()},l=function(b,c){var e=new XMLHttpRequest;return e.open(b,d+c,!0),f&&e.setRequestHeader("Authorization","Bearer "+f),e.setRequestHeader("x-app-id",a),e.setRequestHeader("Accept","application/json"),e},m=function(){var c=document.location.href.match(/(^[^#]*)/)[0],d="id_token token",f=Date.now()+""+Math.random(),g=Math.random();localStorage.state=f;var h=e+"?client_id="+encodeURI(a)+"&redirect_uri="+encodeURI(c)+"&response_type="+encodeURI(d)+"&scope="+encodeURI(b)+"&state="+encodeURI(f)+"&nonce="+encodeURI(g);window.location=h},n=function(){var a=window.location.hash.substr(1),b=a.split("&").reduce(function(a,b){var c=b.split("=");return a[c[0]]=c[1],a},{}),c=!b.error,d={};c&&(b.state!==localStorage.state?c=!1:(localStorage.removeItem("state"),f=b.access_token,d=jwt_decode(b.id_token)));var e=!1;c?(e={connected:!0,accessToken:b.access_token,displayName:d.name,userId:d.sub,email:d.email},Cookies.set("JGOAUTH",JSON.stringify(e),{expires:b.expires})):Cookies.expire("JGOAUTH");var g=document.querySelectorAll("jg-login");return[].forEach.call(g,function(a){if(a.getAttribute("onlogin")){var b=a.getAttribute("onlogin"),c=window[b];c(e)}}),c},o=function(){var a=document.querySelectorAll("jg-login");[].forEach.call(a,function(a){a.innerHTML="Connect with JustGiving",a.style.fontWeight=400,a.style.fontFamily="roboto, arial",a.style.textDecoration="none",a.style.display="inline",a.style.width="auto",a.style.whiteSpace="normal",a.style.verticalAlign="top",a.style.padding="0.5em",a.style.cursor="pointer",a.style.color="#ffffff",a.style.background="#882c84",a.style.fontSize="100%",a.style.borderRadius="2px",a.style.fontSmoothingEnabled=!0,a.style.textAlign="center",a.style.marginTop="64px",a.addEventListener("click",function(){m()})})},p=function(){var a="openid profile email fundraise account",b="/connect/authorize",c=new Array;c.local="http://api.local.justgiving.com",c.dev="https://api-integration.staging.justgiving.com",c.staging="https://api-integration.staging.justgiving.com",c.sandbox="https://api-sandbox.justgiving.com",c.production="https://api.justgiving.com";var d=new Array;return d.local="https://identity.local.justgiving.com",d.dev="https://identity.dev.justgiving.com",d.staging="https://identity.staging.justgiving.com",d.sandbox="https://identity.sandbox.justgiving.com",d.production="https://identity.justgiving.com",{defaultScopes:a,authorizeResource:b,environments:c,identityServers:d}}(),q=function(){var a=function(){b()},b=function(){document.registerElement("jg-login",{prototype:Object.create(HTMLSpanElement.prototype),"extends":"span"})};return{register:a}}();return{init:g,checkConnected:h,signOut:i,getFundraisingPages:j,getFeed:k,CustomElements:q}}();window.onload=function(){};